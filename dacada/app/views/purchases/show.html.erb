<h1>My Cart</h1>

<% if flash[:error] %>
    <% if flash[:error]['item'] %>
        <h3><%= flash[:error]['item'][0] %></h3>
    <% elsif flash[:error]['user'] %>
        <h3><%= flash[:error]['user'][0] %><a href="/login">here</a><%= flash[:error]['user'][1] %></h3>
    <% end %>
<% end %>

<% if @added %>
  Item:  <%= @item.name %></a></br>
  Price: $<%= @item.price %>
  <form class="" action="/add_to_cart" method="post">
    <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
    <input type="hidden" name="item_id" value="<%= @item.id %>">
    <input type="number" name="quantity" min="1" max="100" step='1' value="1"></br>
    <input type="submit" name="cartBtn" value="Add to Cart">
  </form>
<% end %>

<% if !@cart.empty? %>
    <table>
        <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Action</th>
        </tr>
        <% @cart.each_with_index do |id, index| %>
            <tr>
                <td><%= Item.find(id).name %></td>
                <td><%= session[:quantities][index] %> ct.</td>
                <td>$<%= @prices[index] %></td>
                <td> <a href="/remove/<%= index %>">Remove</a></td>
            </tr>
        <% end %>
    </table>
    Total: $<%= @total %>

    <form class="" action="/purchase" method="post">
        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
        <input type="submit" name="purchaseBtn" value="Make Purchase">
    </form>
<% else %>
    <h3>There's Nothing in Your Cart</h3>
<% end %>
<a href="/deals">All Deals</a></br>
<a href="/logout">Logout</a></br>
